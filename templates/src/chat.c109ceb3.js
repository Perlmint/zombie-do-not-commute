(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{124:function(e,t,n){},127:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var o,a=n(49),s=n.n(a),r=n(15),i=n.n(r),c=n(44),u=n.n(c),l=n(45),d=n.n(l),v=n(46),h=n.n(v),f=n(47),m=n.n(f),E=n(52),_=n.n(E),w=n(48),p=n.n(w),M=n(50),g=n.n(M),U=(n(124),n(125)),k=n.n(U),R=n(0),O=n.n(R),D=n(21),C=n(51),S=n.n(C);!function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right"}(o||(o={}));var y=function(e){function t(){return u()(this,t),h()(this,m()(t).apply(this,arguments))}return p()(t,e),d()(t,[{key:"render",value:function(){var e=this.props,t=e.side,n=e.msg,a=S()(e,["side","msg"]),s="";switch(t){case o.Left:s="left";break;case o.Right:s="right"}return O.a.createElement("div",i()({className:"balloon ".concat(s)},a),O.a.createElement("div",{className:"block"},n))}}]),t}(O.a.Component);n(127);function L(){return O.a.createElement("div",{className:"spinner-wrap"},O.a.createElement("div",{className:"lds-grid"},O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null),O.a.createElement("div",null)),O.a.createElement("h2",null,"LOADING..."))}var T="undefined"!=typeof PointerEvent,P="undefined"!=typeof TouchEvent;var N,I=T?function(e){return e}:function(e){var t={};return e.onPointerDown&&(P?t.onTouchStart=e.onPointerDown:t.onMouseDown=e.onPointerDown),e.onPointerUp&&(P?t.onTouchEnd=e.onPointerUp:t.onMouseUp=e.onPointerUp),e.onPointerLeave&&(P?t.onTouchCancel=e.onPointerLeave:t.onMouseLeave=e.onPointerLeave),e.onPointerCancel&&(P?t.onTouchCancel=e.onPointerCancel:t.onMouseCancel=e.onPointerCancel),t};!function(e){e[e.SHOULD_COMMUTE=0]="SHOULD_COMMUTE",e[e.COMMUTED=1]="COMMUTED",e[e.NO_MORE_COMMUTE=2]="NO_MORE_COMMUTE"}(N||(N={}));var $=100;function b(e){var t=Math.floor(((new Date).getTime()-e.getTime())/$);return"그어"+"어".repeat(t)}var A=function(e){function t(e,n){var a;return u()(this,t),a=h()(this,m()(t).call(this,e,n)),g()(_()(a),"onReconnectClick",function(){a.connect()}),g()(_()(a),"onReceivceMessage",function(e){a.pushMessage(e.data,o.Left)}),g()(_()(a),"onGrowlDown",function(){a.setState({growl_down_at:new Date}),a.setInterval()}),g()(_()(a),"onGrowlUp",function(){if(void 0!==a.state.growl_down_at){clearInterval(a.state.intervalId);var e=b(a.state.growl_down_at);a.sendMessage(e),a.pushMessage(e,o.Right),a.setState(function(e){return k()(e,{growl_down_at:{$set:void 0},intervalId:{$set:void 0}})})}}),g()(_()(a),"onAttendDown",function(){a.setState(function(e){return k()(e,{attend_down_at:{$set:new Date}})}),a.setInterval()}),g()(_()(a),"onAttendUp",function(){if(void 0!==a.state.attend_down_at){clearInterval(a.state.intervalId);var e=a.createAttendMessage();a.sendMessage(e),a.pushMessage(e,o.Right),a.setState(function(e){return k()(e,{attend_down_at:{$set:void 0},commute_state:{$apply:function(e){switch(e){case N.SHOULD_COMMUTE:return N.COMMUTED;case N.COMMUTED:case N.NO_MORE_COMMUTE:return N.NO_MORE_COMMUTE}}},intervalId:{$set:void 0}})})}}),g()(_()(a),"onInterval",function(){a.setState(function(e){return k()(a.state,{intervalDummy:{$apply:function(e){return!e}}})})}),a.state={commute_state:N.SHOULD_COMMUTE,intervalDummy:!1,messages:[]},a}return p()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.connect()}},{key:"componentWillUnmount",value:function(){this.disconnect()}},{key:"render",value:function(){if(void 0!==this.props.SERVER_URL){if(void 0!==this.state.socket_err)return O.a.createElement("div",{className:"error-msg",onClick:this.onReconnectClick},"Failed to connect to server.",O.a.createElement("br",null),"(",this.state.socket_err,")",O.a.createElement("br",null),"Click here to retry connection.");if(void 0===this.state.socket)return O.a.createElement(L,null)}return O.a.createElement(O.a.Fragment,null,O.a.createElement("div",{className:"buttons-wrap"},this.renderButtonsArea()),O.a.createElement("div",{className:"balloons-wrap"},this.state.messages.map(function(e,t){return O.a.createElement(y,i()({key:t},e))})))}},{key:"connect",value:function(){var e=this;if(void 0!==this.props.SERVER_URL&&void 0===this.state.socket){this.setState(function(e){return k()(e,{socket_err:{$set:void 0}})});try{var t=new WebSocket(this.props.SERVER_URL);t.onopen=function(){e.setState(function(e){return k()(e,{socket:{$set:t}})})},t.onerror=function(){e.setState(function(e){return k()(e,{socket_err:{$set:"Unknown reason"}})})},t.onmessage=this.onReceivceMessage,t.onclose=function(){return e.disconnect()}}catch(o){var n=o;this.setState(function(e){return k()(e,{socket_err:{$set:n.message}})})}}}},{key:"disconnect",value:function(){void 0!==this.state.socket&&(this.state.socket.close(1e3,"Client close"),this.setState(function(e){return k()(e,{socket:{$set:void 0}})}))}},{key:"createAttendMessage",value:function(){var e=this.state.commute_state===N.SHOULD_COMMUTE?"출":"퇴";void 0!==this.state.attend_down_at?e+=b(this.state.attend_down_at):e+="근";return e}},{key:"setInterval",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;this.setState(function(t){return k()(t,{intervalId:{$set:setInterval(e.onInterval,$)}})})})},{key:"sendMessage",value:function(e){void 0!==this.props.SERVER_URL&&this.state.socket.send(e)}},{key:"pushMessage",value:function(e,t){this.setState(function(n){return k()(n,{messages:{$set:[{msg:e,side:t}].concat(s()(n.messages.slice(0,29)))}})})}},{key:"renderButtonsArea",value:function(){var e=[];return void 0===this.state.attend_down_at&&this.state.commute_state===N.COMMUTED&&e.push(O.a.createElement(y,i()({key:"growl-previw",side:void 0!==this.state.growl_down_at?o.Right:o.None,msg:b(void 0!==this.state.growl_down_at?this.state.growl_down_at:new Date)},I({onPointerDown:this.onGrowlDown,onPointerLeave:this.onGrowlUp,onPointerUp:this.onGrowlUp})))),void 0===this.state.growl_down_at&&this.state.commute_state!==N.NO_MORE_COMMUTE&&e.push(O.a.createElement("div",i()({key:"attend-button",className:"attend block"},I({onPointerDown:this.onAttendDown,onPointerLeave:this.onAttendUp,onPointerUp:this.onAttendUp})),this.createAttendMessage())),e}}]),t}(O.a.Component);t.default=function(){var e=Object(D.useSiteData)().SERVER_URL;return O.a.createElement(A,{SERVER_URL:e})}}}]);