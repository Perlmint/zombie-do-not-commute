(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{122:function(t,e,n){},125:function(t,e,n){},55:function(t,e,n){"use strict";n.r(e);var o,a=n(49),s=n.n(a),r=n(15),i=n.n(r),c=n(44),l=n.n(c),u=n(45),d=n.n(u),v=n(46),h=n.n(v),m=n(47),f=n.n(m),_=n(52),p=n.n(_),E=n(48),w=n.n(E),M=n(50),g=n.n(M),U=(n(122),n(123)),k=n.n(U),O=n(0),C=n.n(O),R=n(21),y=n(51),D=n.n(y);!function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right"}(o||(o={}));var S=function(t){function e(){return l()(this,e),h()(this,f()(e).apply(this,arguments))}return w()(e,t),d()(e,[{key:"render",value:function(){var t=this.props,e=t.side,n=t.msg,a=D()(t,["side","msg"]),s="";switch(e){case o.Left:s="left";break;case o.Right:s="right"}var r={};return this.props.balloon_color&&(r["--balloon-color"]=this.props.balloon_color),this.props.text_color&&(r["--text-color"]=this.props.text_color),C.a.createElement("div",i()({className:"balloon ".concat(s)},a,{style:r}),C.a.createElement("div",{className:"block"},n))}}]),e}(C.a.Component);n(125);function b(){return C.a.createElement("div",{className:"spinner-wrap"},C.a.createElement("div",{className:"lds-grid"},C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null),C.a.createElement("div",null)),C.a.createElement("h2",null,"LOADING..."))}var L="undefined"!=typeof PointerEvent,T="undefined"!=typeof TouchEvent;var P,N=L?function(t){return t}:function(t){var e={};return t.onPointerDown&&(T?e.onTouchStart=t.onPointerDown:e.onMouseDown=t.onPointerDown),t.onPointerUp&&(T?e.onTouchEnd=t.onPointerUp:e.onMouseUp=t.onPointerUp),t.onPointerLeave&&(T?e.onTouchCancel=t.onPointerLeave:e.onMouseLeave=t.onPointerLeave),t.onPointerCancel&&(T?e.onTouchCancel=t.onPointerCancel:e.onMouseCancel=t.onPointerCancel),e};!function(t){t[t.SHOULD_COMMUTE=0]="SHOULD_COMMUTE",t[t.COMMUTED=1]="COMMUTED",t[t.NO_MORE_COMMUTE=2]="NO_MORE_COMMUTE"}(P||(P={}));var $=100;function I(t){var e=Math.floor(((new Date).getTime()-t.getTime())/$);return"그어"+"어".repeat(e)}var A=function(t){function e(t,n){var o;return l()(this,e),o=h()(this,f()(e).call(this,t,n)),g()(p()(o),"onReconnectClick",function(){o.connect()}),g()(p()(o),"onReceivceMessage",function(t){var e=JSON.parse(t.data);switch(e.tag){case"colorData":o.setState(function(t){return k()(t,{balloon_color:{$set:e.balloonColor},text_color:{$set:e.textColor}})});break;case"message":o.pushMessage(e)}}),g()(p()(o),"onGrowlDown",function(){o.setState({growl_down_at:new Date}),o.setInterval()}),g()(p()(o),"onGrowlUp",function(){if(void 0!==o.state.growl_down_at){clearInterval(o.state.intervalId);var t=I(o.state.growl_down_at);o.sendMessage(t),o.pushMessage(t),o.setState(function(t){return k()(t,{growl_down_at:{$set:void 0},intervalId:{$set:void 0}})})}}),g()(p()(o),"onAttendDown",function(){o.setState(function(t){return k()(t,{attend_down_at:{$set:new Date}})}),o.setInterval()}),g()(p()(o),"onAttendUp",function(){if(void 0!==o.state.attend_down_at){clearInterval(o.state.intervalId);var t=o.createAttendMessage();o.sendMessage(t),o.pushMessage(t),o.setState(function(t){return k()(t,{attend_down_at:{$set:void 0},commute_state:{$apply:function(t){switch(t){case P.SHOULD_COMMUTE:return P.COMMUTED;case P.COMMUTED:case P.NO_MORE_COMMUTE:return P.NO_MORE_COMMUTE}}},intervalId:{$set:void 0}})})}}),g()(p()(o),"onInterval",function(){o.setState(function(t){return k()(o.state,{intervalDummy:{$apply:function(t){return!t}}})})}),o.state={commute_state:P.SHOULD_COMMUTE,intervalDummy:!1,messages:[]},o}return w()(e,t),d()(e,[{key:"componentDidMount",value:function(){this.connect()}},{key:"componentWillUnmount",value:function(){this.disconnect()}},{key:"render",value:function(){if(void 0!==this.props.SERVER_URL){if(void 0!==this.state.socket_err)return C.a.createElement("div",{className:"error-msg",onClick:this.onReconnectClick},"Failed to connect to server.",C.a.createElement("br",null),"(",this.state.socket_err,")",C.a.createElement("br",null),"Click here to retry connection.");if(void 0===this.state.socket)return C.a.createElement(b,null)}var t={};return this.state.balloon_color&&(t["--my-balloon-color"]=this.state.balloon_color),this.state.text_color&&(t["--my-text-color"]=this.state.text_color),C.a.createElement(C.a.Fragment,null,C.a.createElement("div",{className:"buttons-wrap",style:t},this.renderButtonsArea()),C.a.createElement("div",{className:"balloons-wrap",style:t},this.state.messages.map(function(t,e){return C.a.createElement(S,i()({key:e},t))})))}},{key:"connect",value:function(){var t=this;if(void 0!==this.props.SERVER_URL&&void 0===this.state.socket){this.setState(function(t){return k()(t,{socket_err:{$set:void 0}})});try{var e=new WebSocket(this.props.SERVER_URL);e.onopen=function(){t.setState(function(t){return k()(t,{socket:{$set:e}})})},e.onerror=function(){t.setState(function(t){return k()(t,{socket_err:{$set:"Unknown reason"}})})},e.onmessage=this.onReceivceMessage,e.onclose=function(){return t.disconnect()}}catch(o){var n=o;this.setState(function(t){return k()(t,{socket_err:{$set:n.message}})})}}}},{key:"disconnect",value:function(){void 0!==this.state.socket&&(this.state.socket.close(1e3,"Client close"),this.setState(function(t){return k()(t,{socket:{$set:void 0}})}))}},{key:"createAttendMessage",value:function(){var t=this.state.commute_state===P.SHOULD_COMMUTE?"출":"퇴";void 0!==this.state.attend_down_at?t+=I(this.state.attend_down_at):t+="근";return t}},{key:"setInterval",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=this;this.setState(function(e){return k()(e,{intervalId:{$set:setInterval(t.onInterval,$)}})})})},{key:"sendMessage",value:function(t){void 0!==this.props.SERVER_URL&&this.state.socket.send(t)}},{key:"pushMessage",value:function(t){var e;e="string"==typeof t?{msg:t,side:o.Right}:{msg:t.message,side:o.Left,text_color:t.textColor,balloon_color:t.balloonColor},this.setState(function(t){return k()(t,{messages:{$set:[e].concat(s()(t.messages.slice(0,29)))}})})}},{key:"renderButtonsArea",value:function(){var t=[];return void 0===this.state.attend_down_at&&this.state.commute_state===P.COMMUTED&&t.push(C.a.createElement(S,i()({key:"growl-previw",side:void 0!==this.state.growl_down_at?o.Right:o.None,msg:I(void 0!==this.state.growl_down_at?this.state.growl_down_at:new Date)},N({onPointerDown:this.onGrowlDown,onPointerLeave:this.onGrowlUp,onPointerUp:this.onGrowlUp})))),void 0===this.state.growl_down_at&&this.state.commute_state!==P.NO_MORE_COMMUTE&&t.push(C.a.createElement("div",i()({key:"attend-button",className:"attend block"},N({onPointerDown:this.onAttendDown,onPointerLeave:this.onAttendUp,onPointerUp:this.onAttendUp})),this.createAttendMessage())),t}}]),e}(C.a.Component);e.default=function(){var t=Object(R.useSiteData)().SERVER_URL;return C.a.createElement(A,{SERVER_URL:t})}}}]);